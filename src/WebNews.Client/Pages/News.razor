@page "/news"
@using WebNews.Client.Models
@using WebNews.Client.Services
@inject NewsService NewsService

<PageTitle>Новости</PageTitle>

<div class="container">
    <h1 class="mb-4">Последние новости</h1>

    @if (news == null)
    {
        <div class="text-center py-5">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Загрузка...</span>
            </div>
            <p class="mt-3">Загрузка новостей...</p>
        </div>
    }
    else
    {
        <div class="news-container">
            @foreach (var article in news.Results)
            {
                <div class="news-card">
                    @if (!string.IsNullOrEmpty(article.ImageUrl))
                    {
                        <img src="@article.ImageUrl" alt="@article.Title" class="news-image" />
                    }
                    <div class="news-content">
                        <h2>@article.Title</h2>
                        <p>@article.Description</p>
                        <div class="news-meta">
                            <span>
                                <i class="bi bi-newspaper"></i>
                                @article.SourceName
                            </span>
                            <span>
                                <i class="bi bi-clock"></i>
                                @article.PubDate
                            </span>
                        </div>
                        <a href="@article.Link" target="_blank" class="btn btn-primary w-100">
                            <i class="bi bi-arrow-right-circle me-2"></i>
                            Читать далее
                        </a>
                    </div>
                </div>
            }
        </div>

        @if (!string.IsNullOrEmpty(news.NextPage))
        {
            <button class="btn btn-secondary btn-load-more" @onclick="LoadMore">
                <i class="bi bi-arrow-down-circle me-2"></i>
                Загрузить еще
            </button>
        }
    }
</div>

@code {
    private NewsResponse? news;

    protected override async Task OnInitializedAsync()
    {
        news = await NewsService.GetCachedNewsAsync();
    }

    private async Task LoadMore()
    {
        if (!string.IsNullOrEmpty(news?.NextPage))
        {
            var moreNews = await NewsService.GetLatestNewsAsync(news.NextPage);
            news.Results.AddRange(moreNews.Results);
            news.NextPage = moreNews.NextPage;
        }
    }
} 